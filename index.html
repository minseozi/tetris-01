<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mobile Tetris (Final Fix)</title>
    
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 10px;
            user-select: none; /* 모바일에서 드래그 방지 */
        }

        #game-container {
            width: 90%;
            max-width: 400px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 10px;
            margin-bottom: 10px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-top: 0;
        }

        #info-panel {
            display: flex;
            justify-content: space-around;
            padding: 5px;
            margin-bottom: 10px;
            border-bottom: 2px solid #ddd;
        }
        
        #next-piece-display {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            width: 60px; /* 4x4 크기 */
            height: 60px;
            margin-left: 10px;
        }

        #game-board {
            display: grid;
            /* JS에서 10x20 그리드로 설정됩니다 */
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(20, 1fr);
            width: 100%;
            height: calc(100vw * 2); /* 화면 너비에 맞게 높이 조정 (2:1 비율) */
            max-height: 800px; /* 최대 높이 설정 */
            border: 5px solid #333;
            background-color: #111;
            margin: 0 auto;
        }

        .cell {
            /* 각 칸의 기본 스타일 */
            aspect-ratio: 1 / 1; /* 정사각형 유지 */
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-sizing: border-box;
        }

        /* 블록 색상 */
        .i { background-color: cyan; border-color: #00ffff80; }
        .j { background-color: blue; border-color: #0000ff80; }
        .l { background-color: orange; border-color: #ffa50080; }
        .o { background-color: yellow; border-color: #ffff0080; }
        .s { background-color: green; border-color: #00800080; }
        .t { background-color: purple; border-color: #80008080; }
        .z { background-color: red; border-color: #ff000080; }

        #controls {
            display: grid;
            grid-template-areas: 
                "left rotate right"
                "down fast-drop fast-drop";
            gap: 10px;
            width: 90%;
            max-width: 400px;
            padding: 10px 0;
        }

        #controls button {
            padding: 15px;
            font-size: 1.5em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            background-color: #4CAF50;
            color: white;
            box-shadow: 0 3px 0 #388E3C;
            cursor: pointer;
            transition: background-color 0.1s;
        }

        #left { grid-area: left; background-color: #2196F3; box-shadow: 0 3px 0 #1976D2; }
        #rotate { grid-area: rotate; }
        #right { grid-area: right; background-color: #2196F3; box-shadow: 0 3px 0 #1976D2; }
        #down { grid-area: down; background-color: #FF9800; box-shadow: 0 3px 0 #FB8C00; }
        #fast-drop { grid-area: fast-drop; background-color: #F44336; box-shadow: 0 3px 0 #D32F2F; }

        #controls button:active {
            box-shadow: none;
            transform: translateY(3px);
        }

        #message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            font-size: 2em;
            text-align: center;
            z-index: 10;
        }
        .hidden { display: none; }

        /* 작은 화면 (모바일)에 최적화 */
        @media (max-width: 600px) {
            #game-board {
                height: 400px; /* 작은 화면에서는 고정 높이 */
